{"ast":null,"code":"import { utilService } from './util.service.js';\nimport { storageService } from './async-storage.service.js';\nconst USER_KEY = 'userDB';\n_createUsers();\nexport const userService = {\n  getById,\n  signup,\n  login,\n  logout,\n  getEmptyCredentials,\n  getLoggedinUser\n};\nfunction getById(userId) {\n  return storageService.get(USER_KEY, userId);\n}\nfunction signup(credentials) {\n  const users = storageService.query(USER_KEY);\n  if (users.find(u => u.username === credentials.username)) return Promise.reject('there is already a user with that username');else return storageService.post(USER_KEY, credentials).then(user => {\n    _saveLoggedinUser(user);\n    return user;\n  });\n}\nfunction login(credentials) {\n  return storageService.query(USER_KEY).then(users => {\n    const user = users.find(u => u.username === credentials.username);\n    if (!user) return Promise.reject('Login failed');\n    _saveLoggedinUser(user);\n    return user;\n  });\n}\nfunction getEmptyCredentials() {\n  let username = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return {\n    username\n  };\n}\nfunction getLoggedinUser() {\n  console.log(JSON.parse(sessionStorage.getItem('loggedinUser') || null));\n  return JSON.parse(sessionStorage.getItem('loggedinUser') || null);\n}\nfunction logout() {\n  sessionStorage.removeItem('loggedinUser');\n  return Promise.resolve();\n}\nfunction _saveLoggedinUser(user) {\n  sessionStorage.setItem('loggedinUser', JSON.stringify(user));\n}\nfunction _createUsers() {\n  let users = utilService.loadFromStorage(USER_KEY);\n  if (!users || !users.length) {\n    users = [];\n    users.push(_createUser('muki'));\n    users.push(_createUser('puki'));\n    utilService.saveToStorage(USER_KEY, users);\n  }\n}\nfunction _createUser(username) {\n  const user = getEmptyCredentials(username);\n  user._id = utilService.makeId();\n  return user;\n}","map":{"version":3,"names":["utilService","storageService","USER_KEY","_createUsers","userService","getById","signup","login","logout","getEmptyCredentials","getLoggedinUser","userId","get","credentials","users","query","find","u","username","Promise","reject","post","then","user","_saveLoggedinUser","arguments","length","undefined","console","log","JSON","parse","sessionStorage","getItem","removeItem","resolve","setItem","stringify","loadFromStorage","push","_createUser","saveToStorage","_id","makeId"],"sources":["/Users/orit/Documents/CodingAcademy/spotify/frontend/src/services/user.service.local.js"],"sourcesContent":["import { utilService } from './util.service.js'\r\nimport { storageService } from './async-storage.service.js'\r\n\r\nconst USER_KEY = 'userDB'\r\n_createUsers()\r\n\r\nexport const userService = {\r\n    getById,\r\n    signup,\r\n    login,\r\n    logout,\r\n    getEmptyCredentials,\r\n    getLoggedinUser,\r\n}\r\n\r\n\r\nfunction getById(userId) {\r\n    return storageService.get(USER_KEY, userId)\r\n}\r\n\r\n\r\nfunction signup(credentials) {\r\n    const users = storageService.query(USER_KEY)\r\n    if (users.find(u => u.username === credentials.username)) return Promise.reject('there is already a user with that username')\r\n    else return storageService.post(USER_KEY, credentials)\r\n        .then((user) => {\r\n            _saveLoggedinUser(user)\r\n            return user\r\n        })\r\n}\r\n\r\nfunction login(credentials) {\r\n    return storageService.query(USER_KEY)\r\n        .then(users => {\r\n            const user = users.find(u => u.username === credentials.username)\r\n            if (!user) return Promise.reject('Login failed')\r\n            _saveLoggedinUser(user)\r\n            return user\r\n        })\r\n}\r\n\r\nfunction getEmptyCredentials(username = '') {\r\n    return { username }\r\n}\r\n\r\nfunction getLoggedinUser() {\r\n    console.log(JSON.parse(sessionStorage.getItem('loggedinUser') || null))\r\n    return JSON.parse(sessionStorage.getItem('loggedinUser') || null)\r\n}\r\n\r\nfunction logout() {\r\n    sessionStorage.removeItem('loggedinUser')\r\n    return Promise.resolve()\r\n}\r\n\r\nfunction _saveLoggedinUser(user) {\r\n    sessionStorage.setItem('loggedinUser', JSON.stringify(user))\r\n}\r\n\r\n\r\nfunction _createUsers() {\r\n    let users = utilService.loadFromStorage(USER_KEY)\r\n    if (!users || !users.length) {\r\n        users = []\r\n        users.push(_createUser('muki'))\r\n        users.push(_createUser('puki'))\r\n\r\n        utilService.saveToStorage(USER_KEY, users)\r\n    }\r\n}\r\n\r\nfunction _createUser(username) {\r\n    const user = getEmptyCredentials(username)\r\n    user._id = utilService.makeId()\r\n    return user\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}