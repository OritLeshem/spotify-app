{"ast":null,"code":"import _regeneratorRuntime from\"/Users/orit/Documents/CodingAcademy/spotify/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/orit/Documents/CodingAcademy/spotify/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{showErrorMsg}from'./event-bus.service';import{httpService}from'./http.service.js';var STORAGE_KEY_LOGGEDIN_USER='loggedinUser';export var userService={getById:getById,signup:signup,login:login,logout:logout,getEmptyCredentials:getEmptyCredentials,getLoggedinUser:getLoggedinUser};function getById(userId){return httpService.get(\"user/\".concat(userId));}function signup(_x){return _signup.apply(this,arguments);}function _signup(){_signup=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(userCred){var user;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return httpService.post('auth/signup',userCred);case 3:user=_context.sent;return _context.abrupt(\"return\",saveLocalUser(user));case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);showErrorMsg('Username is already taken');case 10:case\"end\":return _context.stop();}},_callee,null,[[0,7]]);}));return _signup.apply(this,arguments);}function saveLocalUser(user){user={_id:user._id,username:user.username};sessionStorage.setItem(STORAGE_KEY_LOGGEDIN_USER,JSON.stringify(user));return user;}function login(_x2){return _login.apply(this,arguments);}function _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(userCred){var user;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return httpService.post('auth/login',userCred);case 3:user=_context2.sent;if(!user){_context2.next=6;break;}return _context2.abrupt(\"return\",saveLocalUser(user));case 6:_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);showErrorMsg('Invalid username');case 11:case\"end\":return _context2.stop();}},_callee2,null,[[0,8]]);}));return _login.apply(this,arguments);}function logout(){return _logout.apply(this,arguments);}function _logout(){_logout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:sessionStorage.removeItem(STORAGE_KEY_LOGGEDIN_USER);_context3.next=3;return httpService.post('auth/logout');case 3:return _context3.abrupt(\"return\",_context3.sent);case 4:case\"end\":return _context3.stop();}},_callee3);}));return _logout.apply(this,arguments);}function getEmptyCredentials(){var username=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';return{username:username};}function getLoggedinUser(){console.log(JSON.parse(sessionStorage.getItem('loggedinUser')||null));return JSON.parse(sessionStorage.getItem('loggedinUser')||null);}","map":{"version":3,"names":["showErrorMsg","httpService","STORAGE_KEY_LOGGEDIN_USER","userService","getById","signup","login","logout","getEmptyCredentials","getLoggedinUser","userId","get","concat","_x","_signup","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","userCred","user","wrap","_callee$","_context","prev","next","post","sent","abrupt","saveLocalUser","t0","stop","_id","username","sessionStorage","setItem","JSON","stringify","_x2","_login","_callee2","_callee2$","_context2","_logout","_callee3","_callee3$","_context3","removeItem","length","undefined","console","log","parse","getItem"],"sources":["/Users/orit/Documents/CodingAcademy/spotify/frontend/src/services/user.service.js"],"sourcesContent":["\r\nimport { showErrorMsg } from './event-bus.service'\r\nimport { httpService } from './http.service.js'\r\n\r\nconst STORAGE_KEY_LOGGEDIN_USER = 'loggedinUser'\r\n\r\nexport const userService = {\r\n  getById,\r\n  signup,\r\n  login,\r\n  logout,\r\n  getEmptyCredentials,\r\n  getLoggedinUser,\r\n}\r\n\r\nfunction getById(userId) {\r\n  return httpService.get(`user/${userId}`)\r\n}\r\n\r\nasync function signup(userCred) {\r\n  try {\r\n    const user = await httpService.post('auth/signup', userCred)\r\n    return saveLocalUser(user)\r\n  }\r\n  catch { showErrorMsg('Username is already taken') }\r\n}\r\n\r\nfunction saveLocalUser(user) {\r\n  user = { _id: user._id, username: user.username }\r\n  sessionStorage.setItem(STORAGE_KEY_LOGGEDIN_USER, JSON.stringify(user))\r\n  return user\r\n}\r\n\r\nasync function login(userCred) {\r\n  try {\r\n    const user = await httpService.post('auth/login', userCred)\r\n    if (user) {\r\n      return saveLocalUser(user)\r\n    }\r\n  } catch {\r\n    showErrorMsg('Invalid username')\r\n  }\r\n}\r\n\r\nasync function logout() {\r\n  sessionStorage.removeItem(STORAGE_KEY_LOGGEDIN_USER)\r\n  return await httpService.post('auth/logout')\r\n}\r\n\r\nfunction getEmptyCredentials(username = '') {\r\n  return { username }\r\n}\r\n\r\nfunction getLoggedinUser() {\r\n  console.log(JSON.parse(sessionStorage.getItem('loggedinUser') || null))\r\n  return JSON.parse(sessionStorage.getItem('loggedinUser') || null)\r\n}\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}