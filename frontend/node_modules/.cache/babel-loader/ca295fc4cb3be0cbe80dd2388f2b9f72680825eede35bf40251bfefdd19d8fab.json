{"ast":null,"code":"import _regeneratorRuntime from\"/Users/orit/Documents/CodingAcademy/spotify/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/orit/Documents/CodingAcademy/spotify/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"/Users/orit/Documents/CodingAcademy/spotify/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/orit/Documents/CodingAcademy/spotify/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/orit/Documents/CodingAcademy/spotify/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import{playlistService}from'../services/playlist.service';import{showErrorMsg,showSuccessMsg}from'../services/event-bus.service';import{uploadService}from'../services/upload.service';import{loadPlaylist,loadPlaylists,savePlaylist}from'../store/playlist.actions';import{SET_PLAYLIST}from'../store/playlist.reducer';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export function PlaylistEdit(){var _useState=useState(playlistService.getEmptyPlaylist()),_useState2=_slicedToArray(_useState,2),playlistToEdit=_useState2[0],setPlaylistToEdit=_useState2[1];var user=useSelector(function(storeState){return storeState.userModule.user;});console.log(playlistToEdit);var playlist=useSelector(function(storeState){return storeState.playlistModule.playlist;});var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isMobile=_useState4[0],setIsMobile=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditing=_useState6[0],setIsEditing=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),imgUrl=_useState8[0],setImgUrl=_useState8[1];var navigate=useNavigate();var dispatch=useDispatch();useEffect(function(){dispatch({type:SET_PLAYLIST,playlist:null});if(playlist)loadPlaylist(playlist);},[imgUrl]);useEffect(function(){if(playlist)loadPlaylists('');},[playlist]);useEffect(function(){function handleResize(){if(window.innerWidth<700)setIsMobile(true);if(window.innerWidth>700)setIsMobile(false);}handleResize();window.addEventListener('resize',handleResize);return function(){window.removeEventListener('resize',handleResize);};},[]);function handleChange(_ref){var target=_ref.target;var value=target.value,type=target.type,field=target.name;value=type==='number'?+value:value;setPlaylistToEdit(function(prev){var _objectSpread2;return _objectSpread(_objectSpread({},prev),{},(_objectSpread2={},_defineProperty(_objectSpread2,field,value),_defineProperty(_objectSpread2,\"createdBy\",_objectSpread({},user)),_objectSpread2));});}function onSavePlaylist(_x){return _onSavePlaylist.apply(this,arguments);}function _onSavePlaylist(){_onSavePlaylist=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(ev){var _playlist;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:ev.preventDefault();setIsEditing(false);_context.prev=2;_context.next=5;return savePlaylist(playlistToEdit);case 5:_playlist=_context.sent;showSuccessMsg('saved Playlist!');dispatch({type:SET_PLAYLIST,playlist:_playlist});navigate(\"/detail/\".concat(_playlist._id));_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](2);console.log('err',_context.t0);showErrorMsg('Cannot save playlist');case 15:case\"end\":return _context.stop();}},_callee,null,[[2,11]]);}));return _onSavePlaylist.apply(this,arguments);}function onUploadImg(_x2){return _onUploadImg.apply(this,arguments);}function _onUploadImg(){_onUploadImg=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(ev){var newImgUrl;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return uploadService.uploadImg(ev);case 3:newImgUrl=_context2.sent;setPlaylistToEdit(function(prev){return _objectSpread(_objectSpread({},prev),{},{imgUrl:newImgUrl});});setImgUrl(newImgUrl);showSuccessMsg('saved img!');_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);console.log('err:',_context2.t0);case 12:case\"end\":return _context2.stop();}},_callee2,null,[[0,9]]);}));return _onUploadImg.apply(this,arguments);}var onEditImgClick=function onEditImgClick(){var input=document.createElement('input');input.type='file';input.accept='image/*';input.addEventListener('change',onUploadImg);input.click();};if(!user)return/*#__PURE__*/_jsx(\"span\",{className:\"main-page playlist-details\",children:\"Please signup / login to create a playlist\"});else return/*#__PURE__*/_jsx(\"section\",{className:\"main-page playlist-details\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"playlist-detail-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"playlist-header-img-container \",children:/*#__PURE__*/_jsx(\"img\",{onClick:onEditImgClick,src:playlistToEdit.imgUrl})}),/*#__PURE__*/_jsxs(\"div\",{className:\"playlist-detail-header-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"playlist-detail-header-title-detail\",children:\"Playlist\"}),/*#__PURE__*/_jsx(\"h1\",{onClick:function onClick(){return setIsEditing(true);},className:\"playlist-detail-header-title\",children:playlistToEdit.name}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSavePlaylist,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",className:\"playlist-detail-header-title-input\",id:\"name\",placeholder:\"playlist name...\",onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{className:\"save-new-playlist\",onMouseDown:onSavePlaylist,type:\"submit\",children:\"Save\"})]})]})]})});}","map":{"version":3,"names":["useEffect","useState","useNavigate","useDispatch","useSelector","playlistService","showErrorMsg","showSuccessMsg","uploadService","loadPlaylist","loadPlaylists","savePlaylist","SET_PLAYLIST","jsx","_jsx","jsxs","_jsxs","PlaylistEdit","_useState","getEmptyPlaylist","_useState2","_slicedToArray","playlistToEdit","setPlaylistToEdit","user","storeState","userModule","console","log","playlist","playlistModule","_useState3","_useState4","isMobile","setIsMobile","_useState5","_useState6","isEditing","setIsEditing","_useState7","_useState8","imgUrl","setImgUrl","navigate","dispatch","type","handleResize","window","innerWidth","addEventListener","removeEventListener","handleChange","_ref","target","value","field","name","prev","_objectSpread2","_objectSpread","_defineProperty","onSavePlaylist","_x","_onSavePlaylist","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","ev","_playlist","wrap","_callee$","_context","next","preventDefault","sent","concat","_id","t0","stop","onUploadImg","_x2","_onUploadImg","_callee2","newImgUrl","_callee2$","_context2","uploadImg","onEditImgClick","input","document","createElement","accept","click","className","children","onClick","src","onSubmit","id","placeholder","onChange","onMouseDown"],"sources":["/Users/orit/Documents/CodingAcademy/spotify/frontend/src/pages/playlist-edit.jsx"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { playlistService } from '../services/playlist.service'\nimport { showErrorMsg, showSuccessMsg } from '../services/event-bus.service'\nimport { uploadService } from '../services/upload.service';\n\nimport { loadPlaylist, loadPlaylists, savePlaylist } from '../store/playlist.actions';\nimport { SET_PLAYLIST } from '../store/playlist.reducer'\n\n\nexport function PlaylistEdit() {\n  const [playlistToEdit, setPlaylistToEdit] = useState(playlistService.getEmptyPlaylist())\n  const user = useSelector(storeState => storeState.userModule.user)\n\n  console.log(playlistToEdit)\n  const playlist = useSelector(storeState => storeState.playlistModule.playlist)\n  const [isMobile, setIsMobile] = useState(false)\n  const [isEditing, setIsEditing] = useState(false)\n  const [imgUrl, setImgUrl] = useState(null)\n  const navigate = useNavigate()\n  const dispatch = useDispatch()\n\n  useEffect(() => {\n    dispatch({ type: SET_PLAYLIST, playlist: null })\n    if (playlist) loadPlaylist(playlist)\n  }, [imgUrl])\n\n  useEffect(() => {\n    if (playlist) loadPlaylists('')\n  }, [playlist])\n\n  useEffect(() => {\n    function handleResize() {\n      if (window.innerWidth < 700) setIsMobile(true)\n      if (window.innerWidth > 700) setIsMobile(false)\n    }\n    handleResize()\n    window.addEventListener('resize', handleResize)\n    return () => {\n      window.removeEventListener('resize', handleResize)\n    }\n  }, [])\n\n  function handleChange({ target }) {\n    let { value, type, name: field } = target\n    value = type === 'number' ? +value : value\n    setPlaylistToEdit((prev) => ({ ...prev, [field]: value, createdBy: { ...user } }))\n  }\n\n\n  async function onSavePlaylist(ev) {\n    ev.preventDefault()\n    setIsEditing(false)\n    try {\n      const playlist = await savePlaylist(playlistToEdit)\n      showSuccessMsg('saved Playlist!')\n      dispatch({ type: SET_PLAYLIST, playlist })\n      navigate(`/detail/${playlist._id}`)\n    }\n    catch (err) {\n      console.log('err', err)\n      showErrorMsg('Cannot save playlist')\n    }\n  }\n\n  async function onUploadImg(ev) {\n    try {\n      const newImgUrl = await uploadService.uploadImg(ev)\n      setPlaylistToEdit((prev) => ({ ...prev, imgUrl: newImgUrl }))\n      setImgUrl(newImgUrl)\n      showSuccessMsg('saved img!')\n    }\n    catch (err) {\n      console.log('err:', err)\n    }\n  }\n\n\n  const onEditImgClick = () => {\n    const input = document.createElement('input')\n    input.type = 'file'\n    input.accept = 'image/*'\n    input.addEventListener('change', onUploadImg)\n    input.click()\n  }\n\n  if (!user) return <span className='main-page playlist-details'>Please signup / login to create a playlist</span>\n  else return <section className='main-page playlist-details'>\n    <div className='playlist-detail-header'>\n\n      <div className='playlist-header-img-container '>\n\n        <img onClick={onEditImgClick} src={playlistToEdit.imgUrl} />\n\n      </div>\n\n      <div className='playlist-detail-header-info'>\n        <div className='playlist-detail-header-title-detail'>Playlist</div>\n\n\n        <h1 onClick={() => setIsEditing(true)} className='playlist-detail-header-title'>{playlistToEdit.name}</h1>\n\n        <form onSubmit={onSavePlaylist}>\n          <input type='text'\n            name='name'\n            className='playlist-detail-header-title-input'\n            id='name'\n            placeholder='playlist name...'\n            onChange={handleChange}\n          />\n          <button className='save-new-playlist' onMouseDown={onSavePlaylist} type='submit'>Save</button>\n        </form>\n\n      </div>\n    </div>\n  </section >\n\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}